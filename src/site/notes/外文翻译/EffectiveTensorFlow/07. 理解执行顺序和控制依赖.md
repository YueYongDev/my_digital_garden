---
{"dg-publish":true,"banner":"https://cdn.ytools.xyz/uPic/006tNc79ly1fzpym7tmc9j30u00gwjrj.jpg","permalink":"/å¤–æ–‡ç¿»è¯‘/EffectiveTensorFlow/07. ç†è§£æ‰§è¡Œé¡ºåºå’Œæ§åˆ¶ä¾èµ–/","dgPassFrontmatter":true}
---

![](https://cdn.ytools.xyz/uPic/006tNc79ly1fzpym7tmc9j30u00gwjrj.jpg)

> æœ¬æ–‡ç¿»è¯‘è‡ªï¼š [ã€ŠUnderstanding order of execution and control dependenciesã€‹](https://github.com/vahidk/EffectiveTensorflow#control_deps)ï¼Œ å¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤ï¼Œ ä»…é™äºå­¦æœ¯äº¤æµï¼Œ è¯·å‹¿å•†ç”¨ã€‚ å¦‚æœ‰è°¬è¯¯ï¼Œ è¯·è”ç³»æŒ‡å‡ºã€‚

æ­£å¦‚æˆ‘ä»¬åˆšå¼€å§‹æåˆ°çš„ï¼Œ TensorFlow ä¸ä¼šç«‹åˆ»è¿è¡Œå®šä¹‰äº†çš„æ“ä½œï¼Œ è€Œæ˜¯åœ¨è®¡ç®—å›¾ä¸­åˆ›é€ ä¸€ä¸ªç›¸å…³çš„èŠ‚ç‚¹ï¼Œ è¿™ä¸ªèŠ‚ç‚¹å¯ä»¥ç”¨ `Session.run()` è¿›è¡Œæ‰§è¡Œã€‚ è¿™ä¸ªä½¿å¾— TensorFlow å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œä¼˜åŒ–ï¼Œ ä»¥æ­¤ç¡®å®šæœ€ä½³æ‰§è¡Œé¡ºåºï¼Œ å¹¶ä¸”åœ¨è¿ç®—ä¸­å‰”é™¤ä¸€äº›ä¸éœ€è¦ä½¿ç”¨çš„èŠ‚ç‚¹ã€‚ å¦‚æœä½ åªæ˜¯åœ¨è®¡ç®—å›¾ä¸­ä½¿ç”¨ `tf.Tensors` ï¼Œ ä½ å°±ä¸éœ€è¦æ‹…å¿ƒä¾èµ–é—®é¢˜ï¼Œ ä½†æ˜¯ä½ æ›´å¯èƒ½ä¼šä½¿ç”¨ `tf.Variable()` ï¼Œ è¿™ä¸ªæ“ä½œä½¿å¾—é—®é¢˜å˜å¾—æ›´åŠ å›°éš¾ã€‚ æˆ‘çš„å»ºè®®æ˜¯å¦‚æœå¼ é‡ä¸èƒ½æ»¡è¶³è¿™ä¸ªå·¥ä½œéœ€æ±‚ï¼Œ é‚£ä¹ˆä»…ä»…ä½¿ç”¨ `Variables` å°±è¶³å¤Ÿäº†ã€‚ è¿™ä¸ªå¯èƒ½ä¸å¤Ÿç›´è§‚ï¼Œ æˆ‘ä»¬ä¸å¦¨å…ˆè§‚å¯Ÿä¸€ä¸ªä¾‹å­ï¼š

```python
import tensorflow as tf
a = tf.constant(1)
b = tf.constant(2)
a = a + b
tf.Session().run(a)
```

æ­£å¦‚æˆ‘ä»¬æœŸå¾…çš„é‚£æ ·ï¼Œ â€œaâ€çš„è®¡ç®—ç»“æœæ˜¯ 3ã€‚ æ³¨æ„ä¸‹ï¼Œ æˆ‘ä»¬åˆ›å»ºäº† 3 ä¸ªå¼ é‡ï¼Œ å…¶ä¸­åŒ…å«ä¸¤ä¸ªå¸¸æ•°å¼ é‡å’Œä¸€ä¸ªå‚¨å­˜åŠ æ³•ç»“æœçš„å¼ é‡ã€‚ åŠ¡å¿…æ³¨æ„æˆ‘ä»¬ä¸èƒ½é‡å†™ä¸€ä¸ªå¼ é‡çš„å€¼ï¼Œ å¦‚æœæˆ‘ä»¬æƒ³è¦æ”¹å˜å¼ é‡çš„å€¼ï¼Œ æˆ‘ä»¬å°±å¿…é¡»è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¼ é‡ï¼Œ å°±åƒæˆ‘ä»¬åˆšæ‰åšçš„é‚£æ ·ã€‚

> å°æç¤º ğŸ’¡ï¼šå¦‚æœä½ æ²¡æœ‰å®šä¹‰ä¸€ä¸ªæ–°çš„è®¡ç®—å›¾ï¼Œ TF å°†ä¼šè‡ªåŠ¨åœ°ä¸ºä½ æ„å»ºä¸€ä¸ªé»˜è®¤çš„è®¡ç®—å›¾ã€‚ ä½ å¯ä»¥ä½¿ç”¨ `tf.get_default_graph()` å»è·å¾—ä¸€ä¸ªè®¡ç®—å›¾çš„å¥æŸ„ï¼ˆhandleï¼‰ï¼Œ ç„¶åï¼Œ ä½ å°±å¯ä»¥æŸ¥çœ‹è¿™ä¸ªè®¡ç®—å›¾äº†ã€‚ æ¯”å¦‚ï¼Œ æ‰“å°è¿™ä¸ªè®¡ç®—å›¾çš„æ‰€æœ‰å¼ é‡ï¼š

```python
print(tf.contrib.graph_editor.get_tensors(tf.get_default_graph()))
```

å’Œ tensors ä¸åŒçš„æ˜¯ï¼Œ å˜é‡ Variables å¯ä»¥æ›´æ–°ï¼Œ æ‰€ä»¥è®©æˆ‘ä»¬ç”¨å˜é‡å»å®ç°æˆ‘ä»¬åˆšæ‰çš„éœ€æ±‚ï¼š

```python
a = tf.Variable(1)
b = tf.constant(2)
assign = tf.assign(a, a + b)

sess = tf.Session()
sess.run(tf.global_variables_initializer())
print(sess.run(assign))
```

åŒæ ·ï¼Œ æ­£å¦‚é¢„æœŸä¸€æ ·ï¼Œ æˆ‘ä»¬åˆå¾—åˆ°äº† 3ã€‚ æ³¨æ„åˆ° `tf.assign()` è¿”å›çš„ä»£è¡¨è¿™ä¸ªèµ‹å€¼æ“ä½œçš„å¼ é‡ã€‚ ç›®å‰ä¸ºæ­¢ï¼Œ æ‰€æœ‰ çš„æ“ä½œéƒ½æ²¡æœ‰é—®é¢˜ï¼Œ ä½†æ˜¯è®©æˆ‘ä»¬è§‚å¯Ÿä¸€ä¸ªç¨å¾®æœ‰ç‚¹å¤æ‚çš„ä¾‹å­å§ï¼š

```python
a = tf.Variable(1)
b = tf.constant(2)
c = a + b

assign = tf.assign(a, 5)

sess = tf.Session()
for i in range(10):
    sess.run(tf.global_variables_initializer())
    print(sess.run([assign, c]))
```

æ³¨æ„åˆ°ï¼Œ å¼ é‡ `c` å¹¶æ²¡æœ‰ä¸€ä¸ªç¡®å®šæ€§çš„å€¼ã€‚ è¿™ä¸ªå€¼å¯èƒ½æ˜¯ 3 æˆ–è€… 7ï¼Œ å–å†³äºåŠ æ³•å’Œèµ‹å€¼æ“ä½œè°å…ˆè¿è¡Œã€‚

æ‚¨åº”è¯¥æ³¨æ„ï¼Œ åœ¨ä»£ç ä¸­å®šä¹‰çš„æ“ä½œçš„é¡ºåºä¸ TensorFlow è¿è¡Œæ—¶æ— å…³ã€‚ å”¯ä¸€ä¼šå½±å“åˆ°æ‰§è¡Œé¡ºåºçš„æ˜¯**æ§åˆ¶ä¾èµ–**ã€‚ æ§åˆ¶ä¾èµ–å¯¹äºå¼ é‡æ¥è¯´æ˜¯ç›´æ¥çš„ã€‚ æ¯ä¸€æ¬¡ä½ åœ¨æ“ä½œä¸­ä½¿ç”¨ä¸€ä¸ªå¼ é‡æ—¶ï¼Œ æ“ä½œå°†ä¼šå®šä¹‰ä¸€ä¸ªå¯¹äºè¿™ä¸ªå¼ é‡æ¥è¯´çš„éšå¼çš„ä¾èµ–ã€‚ ä½†æ˜¯å¦‚æœä½ åŒæ—¶ä¹Ÿä½¿ç”¨äº†å˜é‡ï¼Œ äº‹æƒ…å°±å˜å¾—æ›´ç³Ÿç³•äº†ï¼Œ å› ä¸ºå˜é‡å¯ä»¥å–å¾ˆå¤šå€¼ã€‚

å½“å¤„ç†è¿™äº›å˜é‡æ—¶ï¼Œ ä½ å¯èƒ½éœ€è¦æ˜¾å¼åœ°å»é€šè¿‡ä½¿ç”¨ `tf.control_dependencies()` å»æ§åˆ¶ä¾èµ–ï¼Œ å¦‚ï¼š

```python
a = tf.Variable(1)
b = tf.constant(2)
c = a + b

with tf.control_dependencies([c]):
    assign = tf.assign(a, 5)

sess = tf.Session()
for i in range(10):
    sess.run(tf.global_variables_initializer())
    print(sess.run([assign, c]))
```

è¿™ä¼šç¡®ä¿èµ‹å€¼æ“ä½œåœ¨åŠ æ³•æ“ä½œä¹‹åè¢«è°ƒç”¨ã€‚
