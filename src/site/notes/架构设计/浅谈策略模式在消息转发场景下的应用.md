---
{"title":"æµ…è°ˆç­–ç•¥æ¨¡å¼åœ¨æ¶ˆæ¯è½¬å‘åœºæ™¯ä¸‹çš„åº”ç”¨","categories":["æŠ€æœ¯ç§‘æ™®"],"tags":["ç­–ç•¥æ¨¡å¼","æ¶æ„è®¾è®¡"],"dg-publish":true,"permalink":"///","dgPassFrontmatter":true}
---


## èƒŒæ™¯

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯ä¸­å¿ƒï¼Œä¼ é€é—¨ ğŸ‘‰[ã€Šå¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯ä¸­å¿ƒã€‹](https://mp.weixin.qq.com/s/tE6C1zCKotaCIu3MnB9t2g)

æœ‰äº†æ‰¿è½½è¿™äº›æ¶ˆæ¯çš„åœ°æ–¹åï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜ä¾¿æ˜¯ï¼Œ**è¿™äº›æ¶ˆæ¯ä»å“ªé‡Œæ¥ï¼Ÿ**

é€šå¸¸å¯¹äºä¸€ä¸ªå†…å®¹å‹äº§å“æ¥è¯´ï¼Œåœ¨å…¶äº’åŠ¨ä½“ç³»ä¸­ï¼Œä¸ºäº†å¢å¼ºæ¶ˆæ¯çš„ç”¨æˆ·è§¦è¾¾ï¼Œå¢å¼ºç”¨æˆ·çš„äº’åŠ¨å¿ƒæ™ºï¼Œåœ¨äº’åŠ¨ï¼ˆè¯„è®ºã€ç‚¹èµç­‰ï¼‰è¡Œä¸ºå‘ç”Ÿåï¼Œä¼šå°†äº’åŠ¨æ¶ˆæ¯æ¨é€è‡³æ¶ˆæ¯ä¸­å¿ƒï¼Œç„¶åæ ¹æ®ä¸åŒçš„äº’åŠ¨è¡Œä¸ºç±»å‹åŒ¹é…ä¸åŒçš„æ¶ˆæ¯æ¨¡ç‰ˆã€‚

![](https://cdn.ytools.xyz/uPic/e6c9d24ely1h62p6jxt10j213a0u0mzt.jpg)

ç„¶è€Œéšç€äº’åŠ¨è¡Œä¸ºç§ç±»çš„å¢åŠ ï¼ˆå†…å®¹çš„ç‚¹èµã€è¯„è®ºçš„ç‚¹èµâ€¦â€¦ï¼‰ï¼Œä¸æ–­çš„é€šè¿‡ ifâ€¦else æ¥æ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹ç”Ÿæˆä¸åŒçš„æ¶ˆæ¯æ¨¡ç‰ˆä¼šä½¿å¾—ä¸šåŠ¡ä»£ç æ„ˆå‘å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚

![](https://cdn.ytools.xyz/uPic/e6c9d24ely1h62p6eahz2j20ys0eujuh.jpg)

ä¸ä»…å¦‚æ­¤ï¼Œä¸€æ—¦éœ€è¦å¢åŠ ä¸€ç§æ–°çš„äº’åŠ¨æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å¯¹åŸæœ‰ä»£ç è¿›è¡Œç ´åæ€§ä¿®æ”¹ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚å› æ­¤æœ‰å¿…è¦å¯¹äº’åŠ¨è¡Œä¸ºæ¶ˆæ¯è½¬å‘è‡³æ¶ˆæ¯ä¸­å¿ƒè¿™ä¸€åœºæ™¯è¿›è¡ŒæŠ½è±¡ï¼Œè®©åç»­çš„ç»´æŠ¤è€…ã€å»ºè®¾è€…åªéœ€è¦å…³å¿ƒæŸä¸€ç‰¹å®šçš„äº’åŠ¨è¡Œä¸ºæ¶ˆæ¯å³å¯ï¼ˆæˆ‘å¯ä¸æƒ³æœªæ¥è¢«åˆ«äººå–·åœ¨ ğŸ’© å±±ä¸Šæ‹‰ ğŸ’©ï¼‰ã€‚

## ç­–ç•¥æ¨¡å¼

åœ¨è¯´æ˜å…·ä½“çš„å®ç°æ–¹æ¡ˆå‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸ªè®¾è®¡æ¨¡å¼â€”â€”ç­–ç•¥æ¨¡å¼ã€‚

ç­–ç•¥æ¨¡å¼ï¼Œè‹±æ–‡å…¨ç§°æ˜¯ Strategy Design Patternã€‚åœ¨ GoF çš„ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­ï¼Œå®ƒæ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

> Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it.

ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯ï¼šå®šä¹‰ä¸€ç°‡ç®—æ³•ç±»ï¼Œå°†æ¯ä¸ªç®—æ³•åˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥ä½¿ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„å®¢æˆ·ç«¯ï¼ˆè¿™é‡Œçš„å®¢æˆ·ç«¯ä»£æŒ‡ä½¿ç”¨ç®—æ³•çš„ä»£ç ï¼‰ã€‚

ç­–ç•¥æ¨¡å¼ç”¨æ¥è§£è€¦ç­–ç•¥çš„**å®šä¹‰ã€åˆ›å»ºã€ä½¿ç”¨**ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ªå®Œæ•´çš„ç­–ç•¥æ¨¡å¼å°±æ˜¯ç”±è¿™ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„ã€‚

- ç­–ç•¥ç±»çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼ŒåŒ…å«ä¸€ä¸ªç­–ç•¥æ¥å£å’Œä¸€ç»„å®ç°è¿™ä¸ªæ¥å£çš„ç­–ç•¥ç±»ã€‚
- ç­–ç•¥çš„åˆ›å»ºç”±å·¥å‚ç±»æ¥å®Œæˆï¼Œå°è£…ç­–ç•¥åˆ›å»ºçš„ç»†èŠ‚ã€‚
- ç­–ç•¥æ¨¡å¼åŒ…å«ä¸€ç»„ç­–ç•¥å¯é€‰ï¼Œå®¢æˆ·ç«¯ä»£ç å¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸ªç­–ç•¥ï¼Œæœ‰ä¸¤ç§ç¡®å®šæ–¹æ³•ï¼šç¼–è¯‘æ—¶é™æ€ç¡®å®šå’Œè¿è¡Œæ—¶åŠ¨æ€ç¡®å®šã€‚å…¶ä¸­ï¼Œâ€œè¿è¡Œæ—¶åŠ¨æ€ç¡®å®šâ€æ‰æ˜¯ç­–ç•¥æ¨¡å¼æœ€å…¸å‹çš„åº”ç”¨åœºæ™¯ã€‚

## å®ç°æ–¹æ¡ˆ

åœ¨å¯¹ç­–ç•¥æ¨¡å¼æœ‰äº†åŸºæœ¬çš„äº†è§£åï¼Œæˆ‘ä»¬å°è¯•åœ¨æœ¬èŠ‚å°†å…¶è¿ç”¨èµ·æ¥ã€‚

ä»”ç»†åˆ†æäº†ç¬¬ä¸€ç« çš„åº”ç”¨åœºæ™¯åæˆ‘ä»¬å‘ç°å…¶å®å®ç°é“¾è·¯å¹¶ä¸å¤æ‚ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://cdn.ytools.xyz/uPic/e6c9d24ely1h62p6veu4rj216c0ivwf1.jpg)

åœ¨æœ¬ä¾‹ä¸­ï¼Œæ ¹æ®ä¸åŒçš„äº’åŠ¨è¡Œä¸ºç±»å‹ï¼Œæˆ‘ä»¬å°†ç‚¹èµæ¶ˆæ¯å’Œè¯„è®ºæ¶ˆæ¯åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š

ç‚¹èµç±»ï¼š

1. å†…å®¹ç‚¹èµ
2. è¯„è®ºç‚¹èµ

è¯„è®ºç±»ï¼š

1. å†…å®¹è¯„è®º
2. å†…å®¹è¯„è®ºçš„å›å¤

### è½¬å‘ç­–ç•¥çš„å®šä¹‰

æ•´ä¸ªæ–¹æ¡ˆä¸­æœ€é‡è¦çš„ä¸€ç¯æ˜¯å¯¹è½¬å‘ç­–ç•¥çš„åŒ¹é…ï¼Œå› æ­¤ç¬¬ä¸€æ­¥æˆ‘ä»¬è¦åšçš„åº”è¯¥æ˜¯å®šä¹‰ä¸€ä¸ªç­–ç•¥ã€‚ä¸ºäº†æ–¹ä¾¿åç»­çš„æ‰©å±•ï¼ˆæœªæ¥å¯èƒ½ä¼šæœ‰å¤šç§è½¬å‘ç­–ç•¥ï¼‰ï¼Œæˆ‘ä»¬æ­¤å¤„å®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£`MsgTransmitStrategy`ã€‚

```java
public interface MsgTransmitStrategy<T> {
  	// æ˜¯å¦å‘½ä¸­ç­–ç•¥
    boolean match(T message);

  	// æ¶ˆæ¯ç±»å‹
    TransmitMsgType getMsgType();

  	// åˆ›å»ºéœ€è¦è½¬å‘çš„æ¶ˆæ¯å®ä½“
    MessageContent createMessageContent(T message);
}
```

æ¯ä¸ªç­–ç•¥éœ€è¦å…·å¤‡çš„è¡Œä¸ºèƒ½åŠ›åº”è¯¥æœ‰ï¼š

- æ˜ç¡®è‡ªå·±æ˜¯å¦å‘½ä¸­äº†è½¬å‘ç­–ç•¥ï¼š`match(T message)`
- æ˜ç™½è‡ªå·±è¦è½¬å‘çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯ï¼š`getMsgType()`
- åˆ›å»ºè¦è½¬å‘çš„æ¶ˆæ¯ï¼š`createMessageContent(T message)`

### è½¬å‘ç­–ç•¥çš„åˆ›å»º

ä»¥ç‚¹èµæ¶ˆæ¯ä¸ºä¾‹ï¼Œä¸Šæ–‡æåˆ°å­˜åœ¨ä¸¤ç§ç‚¹èµæ¶ˆæ¯çš„è½¬å‘ç­–ç•¥ï¼šå†…å®¹ç‚¹èµä¸è¯„è®ºç‚¹èµã€‚

å› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ªå…·ä½“çš„ç­–ç•¥ï¼š`ContentLikeMsgTransmitStrategy`å’Œ`CommentLikeMsgTransmitStrategy`

```java
@Component
public class ContentLikeMsgTransmitStrategy implements MsgTransmitStrategy<String> {
    @Override
    public TransmitMsgType getMsgType() {
        return TransmitMsgType.CONTENT_LIKE;
    }

    @Override
    public boolean match(String message) {
        // do something
      	return true;
    }

    @Override
    public MessageContent createMessageContent(String message) {
				// do somethingâ€¦â€¦â€¦â€¦â€¦
        return messageContent;
    }
}

```

```java
@Component
public class CommentLikeMsgTransmitStrategy implements MsgTransmitStrategy<String> {
    @Override
    public TransmitMsgType getMsgType() {
        return TransmitMsgType.COMMENT_LIKE;
    }

    @Override
    public boolean match(String message) {
        // do something
      	return true;
    }

    @Override
    public MessageContent createMessageContent(String message) {
				// do somethingâ€¦â€¦â€¦â€¦â€¦
        return messageContent;
    }
}

```

### è½¬å‘ç­–ç•¥çš„ä½¿ç”¨

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†å‡ ç§æ¶ˆæ¯è½¬å‘ç­–ç•¥äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä»£ç ä¸€èˆ¬å¦‚ä½•ç¡®å®šä½¿ç”¨å“ªä¸ªç­–ç•¥å‘¢ï¼Ÿæœ€å¸¸è§çš„æ˜¯è¿è¡Œæ—¶åŠ¨æ€ç¡®å®šä½¿ç”¨å“ªç§ç­–ç•¥ï¼Œè¿™ä¹Ÿæ˜¯ç­–ç•¥æ¨¡å¼æœ€å…¸å‹çš„åº”ç”¨åœºæ™¯ã€‚

è¿™é‡Œçš„â€œè¿è¡Œæ—¶åŠ¨æ€â€æŒ‡çš„æ˜¯ï¼Œæˆ‘ä»¬äº‹å…ˆå¹¶ä¸çŸ¥é“ä¼šä½¿ç”¨å“ªä¸ªç­–ç•¥ï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ ¹æ®é…ç½®ã€ç”¨æˆ·è¾“å…¥ã€è®¡ç®—ç»“æœç­‰è¿™äº›ä¸ç¡®å®šå› ç´ ï¼ŒåŠ¨æ€å†³å®šä½¿ç”¨å“ªç§ç­–ç•¥ã€‚

æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª`MsgTransmitExecutor`ä½œä¸ºç­–ç•¥çš„æ‰§è¡Œå™¨ï¼Œé€šè¿‡éå†çš„æ‰‹æ®µä¾æ¬¡è°ƒç”¨æ¯ä¸ªç­–ç•¥çš„ match æ–¹æ³•ï¼Œç¬¦åˆæ¡ä»¶çš„ç­–ç•¥ç±»å¯ä»¥æ‰§è¡Œç»Ÿä¸€çš„è½¬å‘æ–¹æ³•ã€‚

```java
@Component
public class MsgTransmitExecutor<T> {

    @Resource
    private MsgTransmitTools msgTransmitTools;

    @Resource
    private BentleyManager bentleyManager;

    public void execute(T message, List<MsgTransmitStrategy<T>> strategyList) {
        for (MsgTransmitStrategy<T> strategy : strategyList) {
          	// ä¾æ¬¡è°ƒç”¨ç­–ç•¥çš„matchæ–¹æ³•
            if (strategy.match(message)) {
                MessageContent messageContent = strategy.createMessageContent(message);
                Optional.ofNullable(messageContent)
                        .filter(mc -> msgTransmitTools.isNeedSendPush(mc))
                        .ifPresent(mc -> bentleyManager.sendMessage(mc));
            }
        }
    }
}
```

é‚£ä¹ˆï¼Œå¯¹äºå®¢æˆ·ç«¯ï¼ˆå®é™…è°ƒç”¨ç­–ç•¥çš„ç±»ï¼‰ï¼Œåªéœ€é€šè¿‡ç»„åˆï¼ˆè€Œéç»§æ‰¿ï¼‰çš„æ–¹å¼ï¼Œå°†ç­–ç•¥çš„æ‰§è¡Œå™¨æ³¨å…¥åˆ°å…·ä½“çš„æ¶ˆæ¯å¤„ç†é€»è¾‘ä¸­å³å¯ã€‚

```java
public class LikeMsgListener extends MessageConsumer<String> {

    /**
     * ç‚¹èµæ¶ˆæ¯è½¬å‘ç­–ç•¥é›†åˆ
     */
    private final List<MsgTransmitStrategy<String>> LIKE_MSG_TRANSMIT_STRATEGY_LIST = Lists.newArrayList();

    @Resource
    private MsgTransmitExecutor<String> msgTransmitExecutor;

    @Resource
    private ContentLikeMsgTransmitStrategy contentLikeMsgTransmitStrategy;

    @Resource
    private CommentLikeMsgTransmitStrategy commentLikeMsgTransmitStrategy;

    @PostConstruct
    public void init() {
        LIKE_MSG_TRANSMIT_STRATEGY_LIST.addAll(Arrays.asList(
                contentLikeMsgTransmitStrategy,
                commentLikeMsgTransmitStrategy
        ));
    }

    @Override
    protected ConsumeConcurrentlyStatus processMessage(String message, MessageExt messageExt) {
        try {
            msgTransmitExecutor.execute(message, LIKE_MSG_TRANSMIT_STRATEGY_LIST);
        } catch (Exception e) {
            PgLog.messageBoxError("LikeListener", e);
        }

        return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
    }
}
```

## æ€»ç»“

åœ¨ä¸Šè¿°å®ä¾‹ä¸­ï¼Œé€šè¿‡ LikeMsgListener ç›‘å¬ç‚¹èµç±»æ¶ˆæ¯ã€‚é€šè¿‡ MsgTransmitStrategy æ¥å£å®šä¹‰æ¶ˆæ¯è½¬å‘è‡³æ¶ˆæ¯ä¸­å¿ƒçš„è¡Œä¸ºç­–ç•¥ï¼ŒMsgTransmitExecutor ä½œä¸ºç­–ç•¥çš„æ‰§è¡Œå™¨æœ€ç»ˆå®ç°å°†åŒ¹é…è¿‡åçš„æ¶ˆæ¯ä»¥ä¸åŒçš„æ¨¡ç‰ˆç±»å‹æ¨é€è‡³æ¶ˆæ¯ä¸­å¿ƒã€‚

æ•´ä¸ªæ–¹æ¡ˆï¼Œé€šè¿‡åˆ©ç”¨ç­–ç•¥æ¨¡å¼é¿å…äº†æ•´ä¸ªè½¬å‘åœºæ™¯ä¸­ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ï¼Œç»´æŠ¤è€…åªéœ€ä¸“æ³¨äºå½“å‰çš„è½¬å‘ç­–ç•¥å³å¯ï¼Œéµå¾ªäº†â€œå¼€é—­åŸåˆ™â€ï¼ŒåŒæ—¶é€šè¿‡ç»„åˆè€Œéç»§æ‰¿çš„æ–¹å¼æ³¨å…¥ç­–ç•¥æ‰§è¡Œå™¨ï¼Œæ‰©å±•æ€§è¾ƒå¥½ã€‚

ä½†ä»»ä½•äº‹ç‰©éƒ½å…·æœ‰ä¸¤é¢æ€§ï¼Œä¸€æ—¦æœªæ¥çš„åœºæ™¯å˜å¾—æ›´åŠ å¤æ‚ï¼ˆä¾‹å¦‚ç‚¹èµè¡Œä¸ºå¯ä»¥æ”¯æŒæ›´å¤šç±»å‹ï¼‰ï¼Œè½¬å‘ç­–ç•¥ç±»ä¼šå¢å¤šï¼Œå±Šæ—¶å°±éœ€è¦è€ƒè™‘ä½¿ç”¨ä¸€äº›æ··åˆæ¨¡å¼ï¼ˆä¾‹å¦‚ç­–ç•¥ä¹Ÿå¯ä»¥ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºç­‰æ–¹æ³•ï¼‰ï¼Œè§£å†³ä¸šåŠ¡å‘å±•æ‰€å¸¦æ¥çš„ç­–ç•¥ç±»è†¨èƒ€çš„é—®é¢˜äº†ã€‚
